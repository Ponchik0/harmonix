# Отчет по аудиту безопасности Harmonix

## Дата аудита
24 февраля 2026

## Обнаруженные проблемы

### ✅ ИСПРАВЛЕНО: Открытые токены и ключи API

Все чувствительные данные были перенесены в переменные окружения:

1. **YouTube API Key** - `AIzaSyBqjE9utIqpSsP2G05iyd2QS36mEBuTJlc`
   - Был захардкожен в `src/services/YouTubeService.ts`
   - Перенесен в `VITE_YOUTUBE_API_KEY`
   - ⚠️ РЕКОМЕНДАЦИЯ: Ограничьте использование ключа в Google Cloud Console

2. **Supabase URL и Anon Key**
   - URL: `https://tgynknhfivavdapobhfk.supabase.co`
   - Anon Key: `sb_publishable_prwmgRXctafvILbt99zSbg_IkMtavGP`
   - Были захардкожены в `src/services/SupabaseService.ts`
   - Перенесены в `VITE_SUPABASE_URL` и `VITE_SUPABASE_ANON_KEY`
   - ℹ️ NOTE: Anon Key безопасен для клиентских приложений при правильной настройке RLS

3. **Discord Client ID** - `1459639329197527275`
   - Был захардкожен в `electron/rpc/discordRpc.ts`
   - Перенесен в `VITE_DISCORD_CLIENT_ID`
   - ℹ️ NOTE: Client ID - это публичный идентификатор, безопасен для использования

4. **Genius Access Token** - `hoAYb8K8ThsPXjavu2t_MWq8EyqpR1BHVyyOyPqfDu4imNPCVRnCEPuiPKS1Stg0`
   - Был захардкожен в `src/services/LyricsService.ts`
   - Перенесен в `VITE_GENIUS_ACCESS_TOKEN`
   - ⚠️ РЕКОМЕНДАЦИЯ: Получите новый токен и ограничьте его права

5. **Happi.dev API Key**
   - Использовался демо-ключ "demo"
   - Перенесен в `VITE_HAPPI_API_KEY`
   - ℹ️ NOTE: Демо-ключ имеет ограничения, рекомендуется получить собственный

6. **Telegram Bot Token**
   - Был плейсхолдер `YOUR_BOT_TOKEN_HERE`
   - Перенесен в `VITE_TELEGRAM_BOT_TOKEN`
   - ✅ OK: Не было реального токена

## Анализ рисков

### Низкий риск
- **Discord Client ID** - публичный идентификатор
- **Supabase Anon Key** - безопасен при правильной настройке RLS
- **Happi.dev demo key** - публичный демо-ключ с ограничениями

### Средний риск
- **YouTube API Key** - может быть использован для исчерпания квоты
  - Рекомендация: Установите ограничения по домену/IP
  - Рекомендация: Настройте квоты в Google Cloud Console

### Высокий риск
- **Genius Access Token** - может быть использован для несанкционированного доступа
  - ⚠️ КРИТИЧНО: Немедленно отзовите старый токен
  - ⚠️ КРИТИЧНО: Создайте новый токен с минимальными правами
  - Рекомендация: Используйте OAuth вместо токена доступа

## SoundCloud токены

SoundCloud использует публичные токены, извлеченные из веб-приложения:
- `EnTrn2ZjaZXfOU7iRsFicZvTOi1Pl3rK` (Token 1 - Primary)

Эти токены:
- Публично доступны в JavaScript коде SoundCloud
- Периодически обновляются SoundCloud
- Имеют встроенную систему ротации и fallback
- Автоматически обновляются через `fetchFreshClientId()`

✅ Безопасно: Это ожидаемое поведение для клиентских приложений

## Реализованные меры безопасности

1. ✅ Создан `.env` файл с реальными значениями
2. ✅ Создан `.env.example` с примерами
3. ✅ `.env` добавлен в `.gitignore` (уже был)
4. ✅ Все токены перенесены в переменные окружения
5. ✅ Создан `SECURITY.md` с инструкциями
6. ✅ Создан этот отчет по аудиту

## Рекомендации

### Немедленные действия (КРИТИЧНО)

1. **Genius Access Token**
   ```bash
   # 1. Отзовите старый токен на https://genius.com/api-clients
   # 2. Создайте новый токен
   # 3. Обновите .env файл
   ```

2. **YouTube API Key**
   ```bash
   # 1. Перейдите в Google Cloud Console
   # 2. Ограничьте ключ только для YouTube Data API v3
   # 3. Добавьте ограничения по домену/IP
   # 4. Установите квоты
   ```

### Краткосрочные действия

1. **Supabase RLS**
   - Проверьте настройки Row Level Security
   - Убедитесь что anon key имеет минимальные права
   - Настройте политики доступа для всех таблиц

2. **Мониторинг**
   - Настройте алерты на превышение квот API
   - Мониторьте необычную активность в Supabase
   - Отслеживайте использование YouTube API

### Долгосрочные действия

1. **Переход на OAuth**
   - Используйте OAuth для Genius вместо токена доступа
   - Реализуйте refresh tokens для долгосрочного доступа

2. **Backend API**
   - Рассмотрите создание backend API для проксирования запросов
   - Храните чувствительные ключи на сервере
   - Реализуйте rate limiting на уровне сервера

3. **Ротация ключей**
   - Регулярно обновляйте API ключи (раз в 3-6 месяцев)
   - Используйте разные ключи для dev/prod окружений
   - Документируйте процесс ротации

## Проверка перед деплоем

```bash
# 1. Убедитесь что .env не в Git
git check-ignore .env

# 2. Проверьте что нет секретов в коде
git diff --cached | grep -i "secret\|password\|token\|key"

# 3. Проверьте что .env.example актуален
diff <(grep -o '^[^#]*=' .env | sort) <(grep -o '^[^#]*=' .env.example | sort)
```

## Контрольный список

- [x] Все токены перенесены в .env
- [x] .env добавлен в .gitignore
- [x] Создан .env.example
- [x] Создана документация по безопасности
- [ ] Отозван старый Genius токен
- [ ] Создан новый Genius токен
- [ ] Настроены ограничения YouTube API
- [ ] Проверены настройки Supabase RLS
- [ ] Настроен мониторинг использования API

## Заключение

Проект имел несколько открытых токенов и ключей API в коде. Все чувствительные данные были успешно перенесены в переменные окружения. 

**Критично важно:**
1. Отозвать и пересоздать Genius Access Token
2. Настроить ограничения для YouTube API Key
3. Проверить настройки безопасности Supabase

После выполнения этих действий уровень безопасности проекта будет значительно повышен.
